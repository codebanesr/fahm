#!/bin/bash

# Detect the CPU architecture
CPU_ARCH=$(uname -m)

# Set the Docker image based on the CPU architecture
if [[ $CPU_ARCH == "arm"* ]]; then
  DOCKER_IMAGE=jlenartjwp/jwt-nginx
else
  DOCKER_IMAGE=ghcr.io/max-lt/nginx-jwt-module:latest
fi

# Export the Docker image variable
export DOCKER_IMAGE

# Determine the command
COMMAND=$1

# Check the command and execute the corresponding Docker Compose command
case "$COMMAND" in
  up)
    docker-compose up -d
    ;;
  down)
    docker-compose down
    ;;
  build)
    docker-compose build
    ;;
  help)
    docker-compose help
    ;;
  *)
    echo "Invalid command. Please use 'up', 'down', 'build', or 'help'."
    exit 1
    ;;
esac